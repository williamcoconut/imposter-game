<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Imposter!</title>
<meta name="description" content="A fun pass-the-phone party game. Find the imposter!">
<meta name="theme-color" content="#1a1a2e">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Imposter!">
<link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiSW1wb3N0ZXIhIiwic2hvcnRfbmFtZSI6IkltcG9zdGVyISIsInN0YXJ0X3VybCI6Ii4iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjMWExYTJlIiwidGhlbWVfY29sb3IiOiIjMWExYTJlIiwiaWNvbnMiOlt7InNyYyI6ImRhdGE6aW1hZ2Uvc3ZnK3htbCw8c3ZnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zycgdmlld0JveD0nMCAwIDEwMCAxMDAnPjxyZWN0IHdpZHRoPScxMDAnIGhlaWdodD0nMTAwJyByeD0nMjAnIGZpbGw9JyMxYTFhMmUnLz48dGV4dCB4PSc1MCcgeT0nNjUnIGZvbnQtc2l6ZT0nNTAnIHRleHQtYW5jaG9yPSdtaWRkbGUnPvCflY08L3RleHQ+PC9zdmc+Iiwic2l6ZXMiOiIxOTJ4MTkyIiwidHlwZSI6ImltYWdlL3N2Zyt4bWwifV19">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg: #1a1a2e;
  --bg2: #16213e;
  --card: #0f3460;
  --accent: #e94560;
  --green: #2ecc71;
  --text: #f0f0f0;
  --text-dim: #a0a0b0;
  --radius: 16px;
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
}

html, body {
  height: 100%;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
  background: linear-gradient(135deg, var(--bg) 0%, var(--bg2) 100%);
  color: var(--text);
  overflow: hidden;
  -webkit-tap-highlight-color: transparent;
  user-select: none;
  -webkit-user-select: none;
}

#app {
  height: 100%;
  display: flex;
  flex-direction: column;
  padding: calc(20px + var(--safe-top)) 20px calc(20px + var(--safe-bottom));
}

/* Screens */
.screen {
  display: none;
  flex-direction: column;
  flex: 1;
  animation: fadeIn 0.3s ease;
}
.screen.active { display: flex; }

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(12px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Typography */
h1 { font-size: 2rem; text-align: center; margin-bottom: 8px; }
h2 { font-size: 1.4rem; text-align: center; color: var(--text-dim); margin-bottom: 24px; font-weight: 400; }
.emoji-title { font-size: 3rem; text-align: center; margin-bottom: 4px; }

/* Buttons */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 16px 32px;
  border: none;
  border-radius: var(--radius);
  font-size: 1.1rem;
  font-weight: 600;
  cursor: pointer;
  transition: transform 0.15s, opacity 0.15s;
  min-height: 52px;
  width: 100%;
  color: #fff;
}
.btn:active { transform: scale(0.96); opacity: 0.9; }
.btn-primary { background: var(--accent); }
.btn-green { background: var(--green); }
.btn-outline {
  background: transparent;
  border: 2px solid var(--text-dim);
  color: var(--text-dim);
}

/* Cards */
.card {
  background: var(--card);
  border-radius: var(--radius);
  padding: 20px;
  margin-bottom: 16px;
}

/* Setup screen */
.setting-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 0;
  border-bottom: 1px solid rgba(255,255,255,0.08);
}
.setting-row:last-child { border-bottom: none; }
.setting-label { font-size: 1rem; }

.stepper {
  display: flex;
  align-items: center;
  gap: 16px;
}
.stepper button {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  border: 2px solid var(--accent);
  background: transparent;
  color: var(--accent);
  font-size: 1.4rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}
.stepper button:active { background: var(--accent); color: #fff; }
.stepper span { font-size: 1.3rem; font-weight: 700; min-width: 28px; text-align: center; }

/* Category grid */
.cat-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 10px;
}
.cat-header span { font-size: 0.95rem; font-weight: 600; }
.cat-header button {
  background: none;
  border: none;
  color: var(--accent);
  font-size: 0.85rem;
  font-weight: 600;
  cursor: pointer;
  padding: 4px 8px;
}
.category-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  margin-bottom: 8px;
  max-height: 220px;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  padding: 4px;
}
.cat-card {
  background: var(--card);
  border: 2px solid transparent;
  border-radius: 12px;
  padding: 10px 6px;
  text-align: center;
  cursor: pointer;
  transition: border-color 0.2s, transform 0.15s, opacity 0.2s;
  font-size: 0.8rem;
  opacity: 0.45;
}
.cat-card .cat-emoji { font-size: 1.4rem; display: block; margin-bottom: 2px; }
.cat-card.selected { border-color: var(--green); opacity: 1; }
.cat-card:active { transform: scale(0.95); }

/* Toggle switch */
.toggle {
  position: relative;
  width: 52px;
  height: 30px;
  flex-shrink: 0;
}
.toggle input { opacity: 0; width: 0; height: 0; }
.toggle .slider {
  position: absolute;
  inset: 0;
  background: #444;
  border-radius: 30px;
  cursor: pointer;
  transition: background 0.3s;
}
.toggle .slider::before {
  content: '';
  position: absolute;
  width: 24px;
  height: 24px;
  left: 3px;
  bottom: 3px;
  background: #fff;
  border-radius: 50%;
  transition: transform 0.3s;
}
.toggle input:checked + .slider { background: var(--green); }
.toggle input:checked + .slider::before { transform: translateX(22px); }

/* Reveal screen */
.reveal-area {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  padding: 20px;
}
.player-badge {
  background: var(--card);
  padding: 10px 28px;
  border-radius: 30px;
  font-size: 1rem;
  font-weight: 600;
  margin-bottom: 24px;
  color: var(--text-dim);
}
.tap-prompt {
  font-size: 1.2rem;
  color: var(--text-dim);
  margin-top: 16px;
}
.role-card {
  background: var(--card);
  border-radius: 20px;
  padding: 32px 24px;
  width: 100%;
  max-width: 340px;
  animation: popIn 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
}
@keyframes popIn {
  from { transform: scale(0.8); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}
.role-card.imposter { border: 3px solid var(--accent); }
.role-card.normal { border: 3px solid var(--green); }
.role-label { font-size: 1.6rem; font-weight: 800; margin-bottom: 8px; }
.role-label.red { color: var(--accent); }
.role-label.green { color: var(--green); }
.secret-word { font-size: 2rem; font-weight: 700; margin: 12px 0; }
.hint-text { color: var(--text-dim); font-size: 0.95rem; margin-top: 8px; }

/* Discussion screen */
.discussion-info {
  text-align: center;
  font-size: 1rem;
  color: var(--text-dim);
  line-height: 1.6;
  margin-bottom: 20px;
  padding: 0 8px;
}
.btn-group { display: flex; flex-direction: column; gap: 12px; margin-top: auto; }

/* Result overlay */
.result-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.85);
  display: none;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 100;
  padding: 32px;
  animation: fadeIn 0.3s ease;
}
.result-overlay.active { display: flex; }
.result-emoji { font-size: 4rem; margin-bottom: 12px; }
.result-text { font-size: 1.2rem; color: var(--text-dim); margin-bottom: 4px; }
.result-player { font-size: 2rem; font-weight: 800; color: var(--accent); margin-bottom: 8px; }
.result-word-label { font-size: 1rem; color: var(--text-dim); }
.result-word { font-size: 1.8rem; font-weight: 700; color: var(--green); margin-bottom: 4px; }

/* Confetti */
.confetti-piece {
  position: fixed;
  width: 10px;
  height: 10px;
  border-radius: 2px;
  z-index: 101;
  animation: confettiFall 2.5s ease-out forwards;
}
@keyframes confettiFall {
  0% { opacity: 1; transform: translateY(0) rotate(0deg); }
  100% { opacity: 0; transform: translateY(100vh) rotate(720deg); }
}

/* Scrollable content area */
.scroll-content {
  flex: 1;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  padding-bottom: 8px;
}

/* Bottom fixed area for buttons */
.bottom-action {
  padding-top: 16px;
  flex-shrink: 0;
}
</style>
</head>
<body>
<div id="app">

  <!-- SETUP SCREEN -->
  <div id="setup" class="screen active">
    <div class="emoji-title">üïµÔ∏è</div>
    <h1>Imposter!</h1>
    <h2>Find the fake</h2>

    <div class="scroll-content">
      <div class="card">
        <div class="setting-row">
          <span class="setting-label">Players</span>
          <div class="stepper">
            <button id="playerMinus">‚àí</button>
            <span id="playerCount">4</span>
            <button id="playerPlus">+</button>
          </div>
        </div>
        <div class="setting-row">
          <span class="setting-label">Show category hint</span>
          <label class="toggle">
            <input type="checkbox" id="categoryHint" checked>
            <span class="slider"></span>
          </label>
        </div>
        <div class="setting-row">
          <span class="setting-label">Show word hint</span>
          <label class="toggle">
            <input type="checkbox" id="wordHint">
            <span class="slider"></span>
          </label>
        </div>
      </div>

      <div class="cat-header">
        <span>Categories</span>
        <button id="catToggleAll">Deselect All</button>
      </div>
      <div id="categoryGrid" class="category-grid"></div>
    </div>

    <div class="bottom-action">
      <button class="btn btn-primary" id="startBtn">Start Game</button>
    </div>
  </div>

  <!-- PASS THE PHONE SCREEN -->
  <div id="reveal" class="screen">
    <div class="reveal-area" id="revealArea">
      <div class="player-badge" id="playerBadge">Player 1</div>
      <div id="revealContent"></div>
    </div>
    <div class="bottom-action" id="revealAction"></div>
  </div>

  <!-- DISCUSSION SCREEN -->
  <div id="discussion" class="screen">
    <div style="flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center;">
      <div style="font-size:4rem; margin-bottom:16px;">üó£Ô∏è</div>
      <h1 style="font-size:1.5rem; margin-bottom:12px;">Discussion Time!</h1>
      <p class="discussion-info">
        Go around the group ‚Äî everyone says a <strong>one-word clue</strong> about the secret word.<br><br>
        Do 2-3 rounds, then vote on who you think the imposter is!
      </p>
    </div>
    <div class="btn-group bottom-action">
      <button class="btn btn-primary" id="revealImposterBtn">Reveal Imposter</button>
      <button class="btn btn-outline" id="menuFromDiscussionBtn">Back to Menu</button>
    </div>
  </div>

</div>

<!-- RESULT OVERLAY -->
<div class="result-overlay" id="resultOverlay">
  <div class="result-emoji">üïµÔ∏è</div>
  <div class="result-text">The imposter was</div>
  <div class="result-player" id="resultPlayer">Player 3</div>
  <div class="result-word-label">The word was</div>
  <div class="result-word" id="resultWord">Elephant</div>
  <div class="result-word-label" id="resultCategory" style="margin-bottom:32px;"></div>
  <div class="btn-group" style="width:100%; max-width:340px;">
    <button class="btn btn-green" id="newRoundBtn">New Round</button>
    <button class="btn btn-outline" id="newGameBtn">New Game</button>
  </div>
</div>

<script>
// ‚îÄ‚îÄ Word Database (each word has a related hint clue) ‚îÄ‚îÄ
const CATEGORIES = {
  "Animals": { emoji: "üêæ", words: [
    ["Elephant","Trunk"],["Tiger","Stripes"],["Penguin","Tuxedo"],["Dolphin","Flipper"],["Eagle","Freedom"],
    ["Kangaroo","Pouch"],["Octopus","Tentacles"],["Giraffe","Neck"],["Chameleon","Camouflage"],["Panda","Bamboo"],
    ["Wolf","Howl"],["Shark","Jaws"],["Flamingo","Pink"],["Gorilla","Chest"],["Butterfly","Cocoon"],
    ["Koala","Eucalyptus"],["Seahorse","Ocean"],["Crocodile","Swamp"]
  ]},
  "Food & Drinks": { emoji: "üçï", words: [
    ["Pizza","Italy"],["Sushi","Chopsticks"],["Taco","Mexico"],["Burger","Bun"],["Pancake","Syrup"],
    ["Smoothie","Blender"],["Croissant","Paris"],["Ramen","Noodles"],["Chocolate","Cocoa"],["Avocado","Toast"],
    ["Pretzel","Twisted"],["Espresso","Caffeine"],["Dumpling","Steamed"],["Cheesecake","Crust"],["Burrito","Wrapped"],
    ["Waffle","Grid"],["Gelato","Scoop"],["Boba","Tapioca"]
  ]},
  "Sports": { emoji: "‚öΩ", words: [
    ["Soccer","Goal"],["Tennis","Racket"],["Surfing","Waves"],["Boxing","Gloves"],["Cricket","Wicket"],
    ["Archery","Bullseye"],["Fencing","Sword"],["Rugby","Tackle"],["Skiing","Snow"],["Volleyball","Net"],
    ["Golf","Hole"],["Bowling","Pins"],["Karate","Belt"],["Badminton","Shuttlecock"],["Wrestling","Mat"],
    ["Climbing","Rope"],["Cycling","Pedal"],["Rowing","Oar"]
  ]},
  "Movies & TV": { emoji: "üé¨", words: [
    ["Batman","Gotham"],["Frozen","Snowflake"],["Titanic","Iceberg"],["Stranger Things","Upside Down"],["Shrek","Ogre"],
    ["Jaws","Beach"],["Friends","Couch"],["Avatar","Blue"],["Matrix","Pill"],["Inception","Dream"],
    ["Simpsons","Yellow"],["Jurassic Park","Dinosaur"],["Rocky","Boxing"],["Mulan","Warrior"],["Squid Game","Doll"],
    ["Minecraft Movie","Blocks"],["Wednesday","Addams"],["Deadpool","Chimichanga"]
  ]},
  "Music": { emoji: "üéµ", words: [
    ["Guitar","Strings"],["Drums","Sticks"],["Piano","Keys"],["Karaoke","Microphone"],["Concert","Stage"],
    ["DJ","Turntable"],["Violin","Bow"],["Trumpet","Brass"],["Hip-Hop","Beats"],["Opera","Soprano"],
    ["Ukulele","Hawaii"],["Flute","Wind"],["Jazz","Improvise"],["Reggae","Jamaica"],["Saxophone","Smooth"],
    ["Choir","Harmony"],["Beatbox","Mouth"],["Harmonica","Blues"]
  ]},
  "Jobs": { emoji: "üíº", words: [
    ["Astronaut","Space"],["Chef","Kitchen"],["Detective","Clues"],["Firefighter","Hose"],["Pilot","Cockpit"],
    ["Surgeon","Scalpel"],["Teacher","Classroom"],["Lifeguard","Whistle"],["Mechanic","Wrench"],["Veterinarian","Pets"],
    ["Plumber","Pipes"],["Architect","Blueprint"],["Barista","Latte"],["Electrician","Wiring"],["Dentist","Teeth"],
    ["Farmer","Harvest"],["Journalist","Headlines"],["Magician","Wand"]
  ]},
  "Countries": { emoji: "üåç", words: [
    ["Japan","Sushi"],["Brazil","Carnival"],["Egypt","Pyramids"],["Australia","Kangaroo"],["Iceland","Geyser"],
    ["Thailand","Temple"],["Mexico","Sombrero"],["Norway","Fjord"],["India","Curry"],["Canada","Maple"],
    ["Morocco","Bazaar"],["Greece","Acropolis"],["Peru","Machu Picchu"],["Vietnam","Pho"],["Kenya","Safari"],
    ["Switzerland","Chocolate"],["Cuba","Cigar"],["Argentina","Tango"]
  ]},
  "School": { emoji: "üìö", words: [
    ["Homework","Deadline"],["Recess","Playground"],["Cafeteria","Lunch"],["Detention","Trouble"],["Prom","Dance"],
    ["Locker","Combination"],["Principal","Office"],["Graduation","Cap"],["Field Trip","Bus"],["Science Fair","Volcano"],
    ["Yearbook","Photos"],["Assembly","Auditorium"],["Tutoring","Help"],["Report Card","Grades"],["Spelling Bee","Letters"],
    ["Backpack","Zipper"],["Chalkboard","Eraser"],["Library","Quiet"]
  ]},
  "Technology": { emoji: "üíª", words: [
    ["Bluetooth","Wireless"],["Selfie","Camera"],["Hashtag","Trending"],["WiFi","Signal"],["Emoji","Smiley"],
    ["Robot","Metal"],["Drone","Flying"],["VR Headset","Virtual"],["Podcast","Episode"],["Smartwatch","Wrist"],
    ["Password","Secret"],["Screenshot","Capture"],["Charging","Battery"],["Algorithm","Pattern"],["Firewall","Security"],
    ["Hologram","Projection"],["Crypto","Bitcoin"],["ChatGPT","AI"]
  ]},
  "Holidays": { emoji: "üéâ", words: [
    ["Christmas","Reindeer"],["Halloween","Pumpkin"],["Thanksgiving","Turkey"],["Easter","Bunny"],["Valentines","Heart"],
    ["New Year","Midnight"],["Birthday","Candles"],["Wedding","Ring"],["Carnival","Mask"],["Diwali","Lantern"],
    ["Hanukkah","Menorah"],["Songkran","Splash"],["Oktoberfest","Beer"],["Mardi Gras","Beads"],["Independence Day","Fireworks"],
    ["Lunar New Year","Dragon"],["Eid","Feast"],["St Patricks Day","Clover"]
  ]},
  "Clothing": { emoji: "üëó", words: [
    ["Sneakers","Laces"],["Sunglasses","Shade"],["Hoodie","Hood"],["Bikini","Beach"],["Tuxedo","Formal"],
    ["Sandals","Summer"],["Beanie","Warm"],["Raincoat","Umbrella"],["Overalls","Farmer"],["Scarf","Winter"],
    ["Stilettos","Heel"],["Vest","Layer"],["Flip-Flops","Thong"],["Jumpsuit","Onesie"],["Cardigan","Button"],
    ["Suspenders","Clip"],["Kimono","Japan"],["Crocs","Holes"]
  ]},
  "Nature": { emoji: "üåø", words: [
    ["Volcano","Lava"],["Waterfall","Cliff"],["Rainbow","Rain"],["Tornado","Funnel"],["Aurora","Northern"],
    ["Desert","Sand"],["Glacier","Ice"],["Coral Reef","Tropical"],["Cave","Dark"],["Lightning","Thunder"],
    ["Meadow","Flowers"],["Canyon","Grand"],["Geyser","Steam"],["Jungle","Vines"],["Tsunami","Wave"],
    ["Blizzard","Frozen"],["Tide Pool","Starfish"],["Stalactite","Dripping"]
  ]},
  "Vehicles": { emoji: "üöó", words: [
    ["Helicopter","Blade"],["Submarine","Underwater"],["Skateboard","Kickflip"],["Ambulance","Siren"],["Sailboat","Wind"],
    ["Motorcycle","Helmet"],["Hot Air Balloon","Basket"],["Jet Ski","Splash"],["Scooter","Kick"],["Tractor","Farm"],
    ["Gondola","Venice"],["Segway","Balance"],["Canoe","Paddle"],["Fire Truck","Ladder"],["Tank","Armor"],
    ["Rickshaw","Pedal"],["Hovercraft","Cushion"],["Zamboni","Ice"]
  ]},
  "Emotions": { emoji: "üòä", words: [
    ["Excited","Butterflies"],["Nervous","Sweating"],["Jealous","Green"],["Grateful","Thankful"],["Confused","Lost"],
    ["Proud","Achievement"],["Embarrassed","Blush"],["Hopeful","Wish"],["Furious","Rage"],["Bored","Yawn"],
    ["Nostalgic","Memories"],["Anxious","Worry"],["Relieved","Phew"],["Grumpy","Morning"],["Amazed","Wow"],
    ["Lonely","Solo"],["Determined","Focused"],["Awkward","Cringe"]
  ]},
  "Board Games": { emoji: "üé≤", words: [
    ["Monopoly","Money"],["Chess","Checkmate"],["Jenga","Tower"],["Scrabble","Letters"],["Clue","Murder"],
    ["Risk","Conquest"],["Battleship","Sink"],["Uno","Reverse"],["Pictionary","Drawing"],["Twister","Dots"],
    ["Checkers","Jump"],["Sorry","Slide"],["Yahtzee","Dice"],["Trivial Pursuit","Questions"],["Connect Four","Drops"],
    ["Dominoes","Tiles"],["Boggle","Shake"],["Operation","Buzzer"]
  ]}
};

// ‚îÄ‚îÄ Build flat word list with category references ‚îÄ‚îÄ
const ALL_WORDS = [];
for (const [name, data] of Object.entries(CATEGORIES)) {
  for (const [word, hint] of data.words) {
    ALL_WORDS.push({ word, hint, category: name, emoji: data.emoji });
  }
}

// ‚îÄ‚îÄ Selected categories (all on by default) ‚îÄ‚îÄ
const selectedCategories = new Set(Object.keys(CATEGORIES));

// ‚îÄ‚îÄ Game State ‚îÄ‚îÄ
let state = {
  players: 4,
  category: "",
  categoryEmoji: "",
  showCategoryHint: true,
  showWordHint: false,
  currentWord: "",
  currentHint: "",
  imposterIndex: -1,
  currentPlayer: 0,
  revealed: false
};

// ‚îÄ‚îÄ DOM refs ‚îÄ‚îÄ
const $ = id => document.getElementById(id);

// ‚îÄ‚îÄ Build category grid ‚îÄ‚îÄ
function buildCategoryGrid() {
  const grid = $('categoryGrid');
  grid.innerHTML = '';
  for (const [name, data] of Object.entries(CATEGORIES)) {
    const card = document.createElement('div');
    card.className = 'cat-card' + (selectedCategories.has(name) ? ' selected' : '');
    card.dataset.cat = name;
    card.innerHTML = `<span class="cat-emoji">${data.emoji}</span>${name}`;
    card.addEventListener('click', () => {
      if (selectedCategories.has(name)) {
        selectedCategories.delete(name);
        card.classList.remove('selected');
      } else {
        selectedCategories.add(name);
        card.classList.add('selected');
      }
      updateToggleLabel();
    });
    grid.appendChild(card);
  }
}

function updateToggleLabel() {
  const total = Object.keys(CATEGORIES).length;
  $('catToggleAll').textContent = selectedCategories.size === total ? 'Deselect All' : 'Select All';
}

$('catToggleAll').addEventListener('click', () => {
  const total = Object.keys(CATEGORIES).length;
  const allSelected = selectedCategories.size === total;
  const cards = $('categoryGrid').querySelectorAll('.cat-card');
  if (allSelected) {
    selectedCategories.clear();
    cards.forEach(c => c.classList.remove('selected'));
  } else {
    Object.keys(CATEGORIES).forEach(k => selectedCategories.add(k));
    cards.forEach(c => c.classList.add('selected'));
  }
  updateToggleLabel();
});

// ‚îÄ‚îÄ Screen navigation ‚îÄ‚îÄ
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  $(id).classList.add('active');
}

// ‚îÄ‚îÄ Player stepper ‚îÄ‚îÄ
$('playerMinus').addEventListener('click', () => {
  if (state.players > 3) {
    state.players--;
    $('playerCount').textContent = state.players;
  }
});
$('playerPlus').addEventListener('click', () => {
  if (state.players < 12) {
    state.players++;
    $('playerCount').textContent = state.players;
  }
});

// ‚îÄ‚îÄ Start Game ‚îÄ‚îÄ
$('startBtn').addEventListener('click', () => {
  if (selectedCategories.size === 0) {
    // Flash the toggle button to hint they need to pick at least one
    $('catToggleAll').style.color = '#f39c12';
    $('catToggleAll').textContent = 'Pick at least one!';
    setTimeout(() => { $('catToggleAll').style.color = ''; updateToggleLabel(); }, 1500);
    return;
  }
  state.showCategoryHint = $('categoryHint').checked;
  state.showWordHint = $('wordHint').checked;
  startRound();
});

function startRound() {
  const pool = ALL_WORDS.filter(w => selectedCategories.has(w.category));
  const pick = pool[Math.floor(Math.random() * pool.length)];
  state.currentWord = pick.word;
  state.currentHint = pick.hint;
  state.category = pick.category;
  state.categoryEmoji = pick.emoji;
  state.imposterIndex = Math.floor(Math.random() * state.players);
  state.currentPlayer = 0;
  state.revealed = false;
  showPlayerScreen();
}

// ‚îÄ‚îÄ Pass-the-Phone ‚îÄ‚îÄ
function showPlayerScreen() {
  showScreen('reveal');
  state.revealed = false;
  $('playerBadge').textContent = `Player ${state.currentPlayer + 1}`;

  // Show tap prompt
  $('revealContent').innerHTML = `
    <div style="font-size:4rem; margin-bottom:16px;">ü§´</div>
    <div class="tap-prompt">Tap to reveal your role</div>
  `;
  $('revealAction').innerHTML = '';

  // Make the reveal area tappable
  $('revealArea').onclick = () => {
    if (state.revealed) return;
    state.revealed = true;
    revealRole();
  };
}

function revealRole() {
  const isImposter = state.currentPlayer === state.imposterIndex;
  $('revealArea').onclick = null;

  if (isImposter) {
    let hints = '';
    if (state.showCategoryHint) {
      hints += `<div class="hint-text">Category: ${state.category}</div>`;
    }
    if (state.showWordHint) {
      hints += `<div class="hint-text">Hint: ${state.currentHint}</div>`;
    }
    $('revealContent').innerHTML = `
      <div class="role-card imposter">
        <div style="font-size:3rem; margin-bottom:8px;">üïµÔ∏è</div>
        <div class="role-label red">You are the IMPOSTER!</div>
        <div style="color:var(--text-dim); font-size:0.95rem;">Try to blend in...</div>
        ${hints}
      </div>
    `;
  } else {
    $('revealContent').innerHTML = `
      <div class="role-card normal">
        <div style="font-size:3rem; margin-bottom:8px;">‚úÖ</div>
        <div class="role-label green">You're safe!</div>
        <div class="secret-word">${state.currentWord}</div>
        <div style="color:var(--text-dim); font-size:0.85rem;">Category: ${state.category}</div>
      </div>
    `;
  }

  const isLast = state.currentPlayer >= state.players - 1;
  $('revealAction').innerHTML = `
    <button class="btn ${isLast ? 'btn-primary' : 'btn-green'}" id="nextPlayerBtn">
      ${isLast ? 'Start Discussion' : 'Pass to Next Player'}
    </button>
  `;
  $('nextPlayerBtn').addEventListener('click', () => {
    if (isLast) {
      startDiscussion();
    } else {
      state.currentPlayer++;
      showPlayerScreen();
    }
  });
}

// ‚îÄ‚îÄ Discussion ‚îÄ‚îÄ
function startDiscussion() {
  showScreen('discussion');
}

$('revealImposterBtn').addEventListener('click', () => showResult());

$('menuFromDiscussionBtn').addEventListener('click', () => showScreen('setup'));

// ‚îÄ‚îÄ Result ‚îÄ‚îÄ
function showResult() {
  $('resultPlayer').textContent = `Player ${state.imposterIndex + 1}`;
  $('resultWord').textContent = state.currentWord;
  $('resultCategory').textContent = `${state.categoryEmoji} ${state.category}`;
  $('resultOverlay').classList.add('active');
  spawnConfetti();
}

$('newRoundBtn').addEventListener('click', () => {
  $('resultOverlay').classList.remove('active');
  startRound();
});

$('newGameBtn').addEventListener('click', () => {
  $('resultOverlay').classList.remove('active');
  showScreen('setup');
});

// ‚îÄ‚îÄ Confetti ‚îÄ‚îÄ
function spawnConfetti() {
  const colors = ['#e94560','#2ecc71','#f39c12','#3498db','#9b59b6','#1abc9c','#e74c3c','#f1c40f'];
  for (let i = 0; i < 60; i++) {
    const el = document.createElement('div');
    el.className = 'confetti-piece';
    el.style.left = Math.random() * 100 + 'vw';
    el.style.top = -10 + 'px';
    el.style.background = colors[Math.floor(Math.random() * colors.length)];
    el.style.animationDelay = (Math.random() * 0.8) + 's';
    el.style.animationDuration = (1.5 + Math.random() * 1.5) + 's';
    el.style.width = (6 + Math.random() * 8) + 'px';
    el.style.height = (6 + Math.random() * 8) + 'px';
    document.body.appendChild(el);
    el.addEventListener('animationend', () => el.remove());
  }
}

// ‚îÄ‚îÄ Service Worker (inline, for offline PWA) ‚îÄ‚îÄ
if ('serviceWorker' in navigator) {
  const swCode = `
    const CACHE = 'imposter-v1';
    self.addEventListener('install', e => {
      e.waitUntil(caches.open(CACHE).then(c => c.addAll(['./', './index.html'])));
      self.skipWaiting();
    });
    self.addEventListener('activate', e => {
      e.waitUntil(caches.keys().then(keys => Promise.all(keys.filter(k => k !== CACHE).map(k => caches.delete(k)))));
      self.clients.claim();
    });
    self.addEventListener('fetch', e => {
      e.respondWith(caches.match(e.request).then(r => r || fetch(e.request)));
    });
  `;
  const blob = new Blob([swCode], { type: 'application/javascript' });
  navigator.serviceWorker.register(URL.createObjectURL(blob)).catch(() => {});
}

// ‚îÄ‚îÄ Boot ‚îÄ‚îÄ
buildCategoryGrid();
</script>
</body>
</html>
